<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <script src="http://angularjs.org/google-code-prettify/prettify.min.js"></script>
        <script src="http://angularjs.org/js/bootstrap.min.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="http://platform.twitter.com/widgets.js"></script>
        <link href='http://fonts.googleapis.com/css?family=Creepster' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://angularjs.org/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://angularjs.org/css/docs.css">
        <link rel="stylesheet" href="http://angularjs.org/css/font-awesome.css">
        <link rel="stylesheet" href="http://angularjs.org/google-code-prettify/prettify.css" type="text/css">
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
        <style type="text/css">
            body {
                background: url('img/bg.gif');
                background-repeat: repeat;
                background-attachment: fixed;
            }

            [role="main"] { margin-bottom: 150px; }

            .graular-title {
                height: 250px;
                background-image: url("img/graular.png");
                background-size: 400px;
                background-position: top right;
                background-repeat: no-repeat;
                color: #000;
                font-family: 'creepster', sans-serif;
                font-size: 72px;
                margin: 0 0 -30px 0 !important;
                padding-top: 150px;
                text-shadow: 2px 2px 0 #0F0, 4px -2px 0 #F0F, -2px 2px 0 #0FF;
                transform:rotate(-3deg);
                -webkit-transform:rotate(-3deg);

            }

            section {
                background: #fff;
                -moz-border-radius: 30px;
                -webkit-border-radius: 30px;
                border-radius: 30px;
                box-shadow: 0 10px 10px 2px rgba(0,0,0,0.3);
                margin-top: 50px;
                padding: 10px 50px 30px 50px;
            }

            article { margin-top: 40px; }

            pre { margin-bottom: 40px; }

            h4 { margin-top: 30px; }

            .nav-tabs { margin-top: 30px; }

            .attr { color: rgb(20, 64, 252); }
            .value { color: rgb(62, 142, 17); }
            .tag  { color: rgb(7, 33, 145); }
            .attr,
            .value,
            .tag { font-weight: bold; }

            .underline { text-decoration: underline; }
        </style>
    </head>
    <body>

    <div role="main" class="container">
        <h1 class="graular-title">Have you seen our Graular?</h1>

        <section class="row">
            <h2>What is Graular?</h2>
            <p>Graular is a a portemanteau term referring to the amalgamation of two technologies: Grails and Angular JS.</p>
            <p>Graular uses a straight-up Grails application for serving content to both anonymous and authenticated users. Authenticated users then have a generous sprinkling of rainbow glitter applied to these pages in the form of Angular JS directives, controllers and services.</p>
        </section>

        <section class="row">
            <h2>Why use Graular?</h2>
            <p>Angular JS is a new and super-exciting JavaScript framework that allows for two-way data-binding and other shenanigans that can make our lives as developers a lot simpler than if we were to try and write the same functionalities from scratch. It is however a browser-side JavaScript implementation and lacks a few things that we require for our Find &amp; Watch project such as true SEO capabilities, legacy browser compatability and dual logic in the Angular Route Controller.</p>
            <p>Grails is a more established server-side technology that we know and love. It is a comfortable pair of slippers that we take for granted and it does what we expect it to do. Unfortunately in order to do some of the more interesting CMS actions that we're trying to achieve it is lacking and would require some hefty JavaScript acrobatics in order to achieve the required results.</p>
            <p>Graular combines these two technologies it a way designed to leverage the advantages and minimise the deficiencies of both. The app is essentially a Grails application for all users but authenticated users with the correct permissions have the AngularJS component injected into their experience along with it's relevant CSS. This allows for a stable and proven application for public users and all of the fun-time interactions for editrons.</p>
        </section>

        <section class="row">
            <h2>How do I use Graular?</h2>
            <p>Graular is a solution driven by the need for two different experiences of the same content. For this reason it is perhaps easiest to think of Graular development in two distinct chunks and approaching them in a very prescriptive manner.</p>
            <article>
                <h3>Developing for Graular</h3>
                <p>Let's consider that we want to represent the following data to the end user;</p>
                <pre>
    {
        name : "free-cats",
        title : "Famous Cats for Free",
        type : "gallery",
        slides : [
            {
                title: "Slide 1",
                text: "Here is slide 1",
                image: {
                    id: "slide-image-1.png"
                }
            }
            {
                title: "Slide 2",
                text: "Here is slide 2",
                image: {
                    id: "slide-image-2.png"
                }
            }
            {
                title: "Slide 3",
                text: "Here is slide 3",
                image: {
                    id: "slide-image-3.png"
                }
            }
        ]
    }
                </pre>
                <h4>Stage 1: Anonymous User Development</h4>
                <p>The first consideration when beginning development of a Graular page is the development of the Anonymous User (public) experience. This encompasses the Grails part of the Graular experience.</p>
                <p>We start developing the Graular to deliver a full public experience without the need to implement AngularJS. We can use any of the conveniences or other useful utilities built in to Grails to get the job done. The solution should be developed to the level that if the page was never content manageable it would provide the full and required experience.</p>
                <div class="tabbable">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#gallery-gsp" data-toggle="tab">gallery.gsp</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="gallery-gsp">
                            <pre>
    <span class="tag">&lt;div</span> <span class="attr">class=</span><span class="value">"gallery-container"</span><span class="tag">&gt;</span>
        <span class="tag">&lt;g:if</span> <span class="attr">test=</span><span class="value">"</span><span class="tag">&dollar;&#123;</span>page.slides<span class="tag">&#125;"&gt;</span>
            <span class="tag">&lt;g:each</span> <span class="attr">in=</span><span class="tag">"&dollar;&#123;</span>page.slides<span class="tag">&#125;"</span> <span class="attr">var=</span><span class="value">"slide"</span> <span class="attr">status=</span><span class="value">"i"</span><span class="tag">&gt;</span>
                <span class="tag">&lt;div <span class="attr">class=</span><span class="value">"slide-container"</span>&gt;</span>
                    <span class="tag">&lt;div <span class="attr">class=</span><span class="value">"slide"</span>&gt;</span>
                        <span class="tag">&lt;img</span> <span class="attr">src=</span><span class="value">"</span><span class="tag">&dollar;&#123;</span>slide.<span class="underline">image</span>?.id ? <span class="value">"</span>${slide.image.id}<span class="value">"</span> : <span class="value">''</span><span class="tag">}" /&gt;</span>
                        <span class="tag">&lt;span</span> <span class="attr">class=</span><span cass="value">"slide-number"</span><span class="tag">&gt;&dollar;&#123;</span>slide.<span class="underline">index</span><span class="tag">&#125;&lt;/span&gt;</span>
                    <span class="tag">&lt;/div&gt;</span>
                    <span class="tag">&lt;h4&gt;&dollar;&#123;</span>slide.title<span class="tag">&#125;&lt;/h4&gt;</span>
                    <span class="tag">&lt;p&gt;&dollar;&#123;</span>slide.text<span class="tag">&#125;&lt;/p&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
            <span class="tag">&lt;/g:each&gt;</span>
        <span class="tag">&lt;/g:if&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
                            </pre>
                        </div>
                    </div>
                </div>
                <p>This will give us a useable representation of the key data. There is no JavaScript involved and the data is available to the end user.</p>
                <h4>Stage 2: Authenticated User Development</h4>
                <p>Now that we have the data presented to the users it is time to inject our AngularJS as we develop the Authenticated User (CMS) experience.</p>
                <div class="tabbable">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#graular-gallery-directive" data-toggle="tab">directive.js</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="graular-gallery-directive">
                            <pre>
    'use strict';

    var graularDirectives = angular.module('graularDirectives');

    graularDirectives.directive('graularGallery', [function() {
        return {
            restrict: 'A',
            controller: 'GraularGalleryCtrl',
            compile: function($templateElement, $templateAttributes) {

                var gContainer = $($templateElement.find('.gallery-container')),
                    slideTemplate = gContainer.find('.slide-container').first(),
                    slide = slideTemplate.find('.slide'),
                    slideImage = slide.find('img');

                var removeBtn = '&lt;button type="button" class="btn btn-small gallery-btn-remove cms-button" data-ng-click="removeSlide($index)" data-ng-show="page.slides.length > 1">Remove&lt;/button&gt;',
                    moveBtn = '&lt;button type="button" class="btn btn-small btn-primary gallery-btn-move disabled hide cms-button">Move&lt;/button&gt;',
                    addBtn = '&lt;button type="button" class="btn btn-small gallery-btn-add cms-button" data-ng-click="addSlide($event, $index)">Add&lt;/button&gt;';

                slideImage.attr("data-ng-src", "{{slide.image.id}}");

                slideImage.attr("data-ng-show", "slide.image");

                slide.find('.slide-number').text('{{$index+1}}');

                slide.append(removeBtn).append(moveBtn).append(addBtn);

                slideTemplate.find('h4').text("{{slide.title}}");
                slideTemplate.find('p').text("{{slide.text}}");
                slideTemplate.attr('data-ng-repeat',"slide in page.slides");

                gContainer.html(slideTemplate);

                gContainer.attr('data-ng-model',"page.slides");
            }
        }
    }]);

                            </pre>
                        </div>
                    </div>
                </div>
                <p>This directive is limited to only react to attributes matching 'graularGallery' (in the AngularJS manners).</p>
                <p>In this directive we have replaced the Grails rendered data values with AngularJS.</p>
                <p>Content is re-rendered to maintain one central location (Grails) for templating logic whilst still being able to apply core AngularJS directives to data-model manipulation. The directive reads the first element from a set of matching elements and uses it as it's template for replicating the set. Due to the order in which AngularJS compiles elements we use an 'inside-out' approach to manipulating elements within this template. We start with the most nested element and work our way outwards, applying directives and data-binding as we go.</p>
                <p>We have also separated our logic around the actual interactions into a separate controller which we bind using the 'controller' part of the Angular directive object;</p>
                <div class="tabbable">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#graular-gallery-controller" data-toggle="tab">controller.js</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="graular-gallery-controller">
                            <pre>
    'use strict';

    var graularControllers = angular.module('graularControllers');

    graularControllers.controller('GraularGalleryCtrl', ['$scope', function($scope) {
        $scope.page.slides = $scope.page.slides || [];
        $scope.state = { dirty: false };

        $scope.addSlide = function(event, index) {
            $scope.page.slides.splice(index + 1, 0, { name: 'Slide ' + ($scope.page.slides.length + 1) });
            $scope.setDirtyFlag();
            event.stopPropagation();
        };

        $scope.removeSlide = function(index) {
            $scope.page.slides.splice(index, 1);
            $scope.setDirtyFlag()
        };

        $scope.setDirtyFlag = function() {
            $scope.state.dirty = true;
        };

        $scope.populateSlide = function(slide,dragged) {
            slide.image = dragged;
        };

        $scope.$on('pageSaved', function () {
            $scope.state.dirty = false;
        });
    }]);
                            </pre>
                        </div>
                    </div>
                </div>
                <p>In this way it should be clear where our concerns lie. The directive takes care of DOM templating and data-model binding whilst the controller takes care of the usage logic and interactions. The directive can bind click events and such to controller functions but the controller should not directly manipulate the DOM.</p>
                <p>We glue the two together by applying a data attribute to the top-level element we want to effect in the DOM. This keeps impact on the public experience minimal whilst supplying the CMS experience with the anchoring it needs to carry out it's manipulations.</p>
                <div class="tabbable">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#gallery-gsp-with-attr" data-toggle="tab">gallery.gsp</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="gallery-gsp-with-attr">
                            <pre>
    <span class="tag">&lt;div</span> <span class="attr">class=</span><span class="value">"gallery-container"</span> <span class="attr">data-graular-gallery</span><span class="tag">&gt;</span>
        <span class="tag">&lt;g:if</span> <span class="attr">test=</span><span class="value">"</span><span class="tag">&dollar;&#123;</span>page.slides<span class="tag">&#125;"&gt;</span>
            <span class="tag">&lt;g:each</span> <span class="attr">in=</span><span class="tag">"&dollar;&#123;</span>page.slides<span class="tag">&#125;"</span> <span class="attr">var=</span><span class="value">"slide"</span> <span class="attr">status=</span><span class="value">"i"</span><span class="tag">&gt;</span>
                <span class="tag">&lt;div <span class="attr">class=</span><span class="value">"slide-container"</span>&gt;</span>
                    <span class="tag">&lt;div <span class="attr">class=</span><span class="value">"slide"</span>&gt;</span>
                        <span class="tag">&lt;img</span> <span class="attr">src=</span><span class="value">"</span><span class="tag">&dollar;&#123;</span>slide.<span class="underline">image</span>?.id ? <span class="value">"</span>${slide.image.id}<span class="value">"</span> : <span class="value">''</span><span class="tag">}" /&gt;</span>
                        <span class="tag">&lt;span</span> <span class="attr">class=</span><span cass="value">"slide-number"</span><span class="tag">&gt;&dollar;&#123;</span>slide.<span class="underline">index</span><span class="tag">&#125;&lt;/span&gt;</span>
                    <span class="tag">&lt;/div&gt;</span>
                    <span class="tag">&lt;h4&gt;&dollar;&#123;</span>slide.title<span class="tag">&#125;&lt;/h4&gt;</span>
                    <span class="tag">&lt;p&gt;&dollar;&#123;</span>slide.text<span class="tag">&#125;&lt;/p&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
            <span class="tag">&lt;/g:each&gt;</span>
        <span class="tag">&lt;/g:if&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
                            </pre>
                        </div>
                    </div>
                </div>
            </article>
        </section>



        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
        <!--<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.9.1.min.js"><\/script>')</script>-->
        <!--<script src="js/plugins.js"></script>-->
        <!--<script src="js/main.js"></script>-->
    </div>
    </body>
</html>
